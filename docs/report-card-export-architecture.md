# Report Card Export - Architecture Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT (Next.js React)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚        Report Card Page                                â”‚      â”‚
â”‚  â”‚        /dashboard/report-card                          â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
â”‚  â”‚  â”‚   Member     â”‚  â”‚     MSQ      â”‚  â”‚  PROMIS-29  â”‚ â”‚      â”‚
â”‚  â”‚  â”‚   Progress   â”‚  â”‚  Assessment  â”‚  â”‚ Assessment  â”‚ â”‚      â”‚
â”‚  â”‚  â”‚     Tab      â”‚  â”‚     Tab      â”‚  â”‚     Tab     â”‚ â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
â”‚  â”‚  â”‚         [Export Report] Button                   â”‚  â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                              â”‚                                    â”‚
â”‚                              â”‚ Click                             â”‚
â”‚                              â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚        ExportReportModal                               â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚  â˜‘ Member Progress                                     â”‚      â”‚
â”‚  â”‚  â˜‘ MSQ Assessment                                      â”‚      â”‚
â”‚  â”‚  â˜‘ PROMIS-29                                           â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚  â˜‘ Include Charts                                      â”‚      â”‚
â”‚  â”‚  â˜‘ Include Interpretation                              â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚  â­• Download    â­• Email                                â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚      [Cancel]  [Export PDF] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ POST /api/report-card/export-pdf
                                               â”‚ { memberId, sections, options }
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SERVER (Next.js API Routes)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   /api/report-card/export-pdf/route.ts                â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚   1. âœ… Authenticate User                              â”‚      â”‚
â”‚  â”‚   2. âœ… Validate Request                               â”‚      â”‚
â”‚  â”‚   3. ğŸ“Š Fetch Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚      â”‚
â”‚  â”‚   4. ğŸ¨ Render Components       â”‚                     â”‚      â”‚
â”‚  â”‚   5. ğŸ“„ Generate PDF            â”‚                     â”‚      â”‚
â”‚  â”‚   6. â¬‡ï¸  Return File             â”‚                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                      â”‚                           â”‚
â”‚                                      â”‚                           â”‚
â”‚                                      â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   fetchReportCardData()                                â”‚      â”‚
â”‚  â”‚   src/lib/utils/report-data-fetcher.ts                â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚   â€¢ Query member_progress_dashboard                   â”‚      â”‚
â”‚  â”‚   â€¢ Query msq_assessment data (Phase 2)               â”‚      â”‚
â”‚  â”‚   â€¢ Query promis_assessment data (Phase 2)            â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚   Returns: { member, memberProgress, msq, promis }    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                               â”‚                                   â”‚
â”‚                               â–¼                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ SQL Queries
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SUPABASE DATABASE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      leads       â”‚  â”‚  member_progress â”‚  â”‚  msq_surveys â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚    _dashboard    â”‚  â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ member_programs  â”‚  â”‚ promis_surveys   â”‚                     â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Return data
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REACT COMPONENT RENDERING (Server-Side)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   React.createElement()                                â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚   PrintReportLayout                                    â”‚      â”‚
â”‚  â”‚   â”œâ”€â”€ PrintHeader (logo, member, date)                â”‚      â”‚
â”‚  â”‚   â”œâ”€â”€ Content:                                         â”‚      â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ PrintMemberProgress       (if selected)     â”‚      â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ PrintMsqAssessment        (if selected)     â”‚      â”‚
â”‚  â”‚   â”‚   â””â”€â”€ PrintPromisAssessment     (if selected)     â”‚      â”‚
â”‚  â”‚   â””â”€â”€ PrintFooter (confidentiality)                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                               â”‚                                   â”‚
â”‚                               â”‚ renderToString()                  â”‚
â”‚                               â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   HTML String with embedded styles                    â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚   <!DOCTYPE html>                                      â”‚      â”‚
â”‚  â”‚   <html>                                               â”‚      â”‚
â”‚  â”‚     <head>                                             â”‚      â”‚
â”‚  â”‚       <style>/* Print styles */</style>               â”‚      â”‚
â”‚  â”‚     </head>                                            â”‚      â”‚
â”‚  â”‚     <body>                                             â”‚      â”‚
â”‚  â”‚       <!-- Report content -->                          â”‚      â”‚
â”‚  â”‚     </body>                                            â”‚      â”‚
â”‚  â”‚   </html>                                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ Pass HTML
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PDF GENERATION (Puppeteer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   generatePdfFromHtml()                                â”‚      â”‚
â”‚  â”‚   src/lib/utils/pdf-generator.ts                      â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚   1. ğŸš€ Launch headless Chrome                         â”‚      â”‚
â”‚  â”‚   2. ğŸ“„ Load HTML content                              â”‚      â”‚
â”‚  â”‚   3. â³ Wait for dynamic content (charts)              â”‚      â”‚
â”‚  â”‚   4. ğŸ–¨ï¸  Generate PDF with print settings              â”‚      â”‚
â”‚  â”‚   5. ğŸ—‘ï¸  Clean up browser instance                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                               â”‚                                   â”‚
â”‚                               â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚       Puppeteer (Headless Chrome)                      â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚
â”‚  â”‚   â”‚   Browser Instance                           â”‚     â”‚      â”‚
â”‚  â”‚   â”‚                                              â”‚     â”‚      â”‚
â”‚  â”‚   â”‚   â€¢ Renders HTML/CSS                        â”‚     â”‚      â”‚
â”‚  â”‚   â”‚   â€¢ Executes JavaScript                     â”‚     â”‚      â”‚
â”‚  â”‚   â”‚   â€¢ Renders Recharts                        â”‚     â”‚      â”‚
â”‚  â”‚   â”‚   â€¢ Applies print styles                    â”‚     â”‚      â”‚
â”‚  â”‚   â”‚   â€¢ Generates 300 DPI PDF                   â”‚     â”‚      â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                               â”‚                                   â”‚
â”‚                               â”‚ PDF Buffer                        â”‚
â”‚                               â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Binary PDF Data (Buffer)                            â”‚      â”‚
â”‚  â”‚   Size: ~2-5 MB                                        â”‚      â”‚
â”‚  â”‚   Format: application/pdf                             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ HTTP Response
                                â”‚ Content-Type: application/pdf
                                â”‚ Content-Disposition: attachment
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            CLIENT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Browser Downloads PDF                                â”‚      â”‚
â”‚  â”‚                                                         â”‚      â”‚
â”‚  â”‚   Report-Card-John-Doe-2025-01-15.pdf                 â”‚      â”‚
â”‚  â”‚   â¬‡ï¸  Saved to Downloads folder                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   âœ… Success Toast                                     â”‚      â”‚
â”‚  â”‚   "Report exported successfully!"                      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Flow Diagram

```
ExportReportModal
    â”‚
    â”œâ”€ Collects Options
    â”‚   â”œâ”€ Member ID
    â”‚   â”œâ”€ Sections to include
    â”‚   â”œâ”€ Format (PDF)
    â”‚   â””â”€ Delivery method
    â”‚
    â–¼
POST /api/report-card/export-pdf
    â”‚
    â”œâ”€ Authentication Check
    â”‚   â””â”€ Supabase session validation
    â”‚
    â”œâ”€ Data Fetching
    â”‚   â”œâ”€ fetchReportCardData()
    â”‚   â”‚   â”œâ”€ Query leads table
    â”‚   â”‚   â”œâ”€ Query member_progress_dashboard
    â”‚   â”‚   â”œâ”€ Query msq_assessment (Phase 2)
    â”‚   â”‚   â””â”€ Query promis_assessment (Phase 2)
    â”‚   â”‚
    â”‚   â””â”€ Returns ReportCardData
    â”‚
    â”œâ”€ Component Rendering
    â”‚   â”œâ”€ React.createElement(PrintReportLayout)
    â”‚   â”‚   â”œâ”€ PrintHeader
    â”‚   â”‚   â”œâ”€ PrintMemberProgress (if enabled)
    â”‚   â”‚   â”œâ”€ PrintMsqAssessment (if enabled, Phase 2)
    â”‚   â”‚   â”œâ”€ PrintPromisAssessment (if enabled, Phase 2)
    â”‚   â”‚   â””â”€ PrintFooter
    â”‚   â”‚
    â”‚   â”œâ”€ renderToString() â†’ HTML
    â”‚   â””â”€ wrapHtmlForPdf() â†’ Complete HTML doc
    â”‚
    â”œâ”€ PDF Generation
    â”‚   â”œâ”€ generatePdfFromHtml()
    â”‚   â”‚   â”œâ”€ puppeteer.launch()
    â”‚   â”‚   â”œâ”€ page.setContent(html)
    â”‚   â”‚   â”œâ”€ page.waitForTimeout(1500) // Charts
    â”‚   â”‚   â”œâ”€ page.pdf({ format: 'Letter' })
    â”‚   â”‚   â””â”€ browser.close()
    â”‚   â”‚
    â”‚   â””â”€ Returns PDF Buffer
    â”‚
    â””â”€ HTTP Response
        â”œâ”€ Content-Type: application/pdf
        â”œâ”€ Content-Disposition: attachment
        â””â”€ PDF Buffer in body
```

## Data Flow

```
User Action
    â”‚
    â”œâ”€ 1. Select Member
    â”‚   â””â”€ Report Card page state: selectedMember
    â”‚
    â”œâ”€ 2. Click [Export Report]
    â”‚   â””â”€ Opens ExportReportModal
    â”‚
    â”œâ”€ 3. Configure Options
    â”‚   â”œâ”€ Select sections (checkboxes)
    â”‚   â”œâ”€ Choose format (radio)
    â”‚   â””â”€ Select delivery (radio)
    â”‚
    â”œâ”€ 4. Click [Export PDF]
    â”‚   â””â”€ fetch('/api/report-card/export-pdf', { method: 'POST', ... })
    â”‚
    â–¼

Server Processing
    â”‚
    â”œâ”€ 5. Authenticate
    â”‚   â””â”€ Verify Supabase session
    â”‚
    â”œâ”€ 6. Fetch Data
    â”‚   â”œâ”€ leads â†’ member info
    â”‚   â”œâ”€ member_progress_dashboard â†’ progress data
    â”‚   â”œâ”€ msq_* tables â†’ assessment data (Phase 2)
    â”‚   â””â”€ promis_* tables â†’ assessment data (Phase 2)
    â”‚
    â”œâ”€ 7. Render React Components
    â”‚   â”œâ”€ Server-side rendering with data
    â”‚   â””â”€ Convert to HTML string
    â”‚
    â”œâ”€ 8. Generate PDF
    â”‚   â”œâ”€ Launch Puppeteer
    â”‚   â”œâ”€ Load HTML
    â”‚   â”œâ”€ Wait for charts
    â”‚   â””â”€ Export as PDF
    â”‚
    â””â”€ 9. Return Response
        â””â”€ Stream PDF to client
    â”‚
    â–¼

Client Response
    â”‚
    â”œâ”€ 10. Receive PDF Blob
    â”‚   â””â”€ response.blob()
    â”‚
    â”œâ”€ 11. Trigger Download
    â”‚   â”œâ”€ Create blob URL
    â”‚   â”œâ”€ Create <a> element
    â”‚   â”œâ”€ Click programmatically
    â”‚   â””â”€ Clean up
    â”‚
    â”œâ”€ 12. Show Success Toast
    â”‚   â””â”€ "Report exported successfully!"
    â”‚
    â””â”€ 13. Close Modal
```

## File Dependencies

```
Report Card Page
    â”‚
    â”œâ”€â”€ Uses: ExportReportModal
    â”œâ”€â”€ Uses: useReportCardParticipants()
    â””â”€â”€ Calls: POST /api/report-card/export-pdf

ExportReportModal
    â”‚
    â”œâ”€â”€ Uses: exportOptionsSchema (validation)
    â””â”€â”€ Calls: POST /api/report-card/export-pdf

API Route: /api/report-card/export-pdf
    â”‚
    â”œâ”€â”€ Uses: createServerClient (Supabase)
    â”œâ”€â”€ Uses: fetchReportCardData()
    â”œâ”€â”€ Uses: generatePdfFromHtml()
    â”œâ”€â”€ Uses: PrintReportLayout
    â”œâ”€â”€ Uses: PrintMemberProgress
    â””â”€â”€ Uses: renderToString (React)

fetchReportCardData()
    â”‚
    â”œâ”€â”€ Uses: Supabase client
    â””â”€â”€ Returns: ReportCardData

generatePdfFromHtml()
    â”‚
    â”œâ”€â”€ Uses: puppeteer
    â””â”€â”€ Returns: Buffer

PrintReportLayout
    â”‚
    â”œâ”€â”€ Uses: PrintHeader
    â”œâ”€â”€ Uses: PrintFooter
    â”œâ”€â”€ Uses: printStyles
    â””â”€â”€ Wraps: child components

PrintMemberProgress
    â”‚
    â”œâ”€â”€ Uses: MemberProgressDashboardData (type)
    â””â”€â”€ Uses: printStyles
```

## Technology Stack

| Layer | Technology | Purpose |
|-------|-----------|---------|
| **Frontend** | Next.js 15 + React 19 | UI and page rendering |
| **UI Components** | Material-UI v7 | Design system |
| **State Management** | React Query | Data fetching and caching |
| **API Layer** | Next.js API Routes | Server-side endpoints |
| **Authentication** | Supabase Auth | User session management |
| **Database** | Supabase (PostgreSQL) | Data storage |
| **PDF Generation** | Puppeteer | Headless Chrome for PDFs |
| **React SSR** | ReactDOMServer | Server-side rendering |
| **Validation** | Zod | Schema validation |
| **Type Safety** | TypeScript | Static typing |

## Security Flow

```
1. User Clicks Export
    â”‚
    â–¼
2. Browser sends POST request
   with session cookie
    â”‚
    â–¼
3. API Route validates session
   via Supabase
    â”‚
    â”œâ”€ Invalid â†’ 401 Unauthorized
    â”‚
    â””â”€ Valid â†’ Continue
        â”‚
        â–¼
4. Check user has access to member
   via RLS policies
    â”‚
    â”œâ”€ No access â†’ 403 Forbidden
    â”‚
    â””â”€ Has access â†’ Continue
        â”‚
        â–¼
5. Fetch data with RLS applied
   (Supabase automatically filters)
    â”‚
    â–¼
6. Generate PDF
   (no sensitive data in logs)
    â”‚
    â–¼
7. Stream PDF directly to user
   (no file storage)
    â”‚
    â–¼
8. Clean up resources
   (close browser, clear memory)
```

## Performance Optimization

```
Request â†’ Response Timeline

0ms     â”‚ User clicks Export
        â”‚
100ms   â”‚ Modal submits form
        â”‚ â†’ POST /api/report-card/export-pdf
        â”‚
200ms   â”‚ â†’ Authenticate user
        â”‚
500ms   â”‚ â†’ Fetch data from Supabase (3 queries)
        â”‚
800ms   â”‚ â†’ Render React components to HTML
        â”‚
1.2s    â”‚ â†’ Launch Puppeteer
        â”‚
2.5s    â”‚ â†’ Load HTML, wait for charts
        â”‚
4.0s    â”‚ â†’ Generate PDF
        â”‚
4.5s    â”‚ â†’ Stream response
        â”‚
5.0s    â”‚ âœ… User receives PDF

Total: ~5 seconds
```

**Optimization Opportunities:**
- Cache rendered HTML for 5 minutes
- Pre-warm Puppeteer instance
- Parallel data fetching
- Background job queue for batch exports
- CDN for report assets

## Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Error Scenarios                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  1. Authentication Failure               â”‚
â”‚     â†’ 401 Response                       â”‚
â”‚     â†’ User sees "Unauthorized" toast     â”‚
â”‚                                          â”‚
â”‚  2. Member Not Found                     â”‚
â”‚     â†’ 404 Response                       â”‚
â”‚     â†’ User sees "Member not found" toast â”‚
â”‚                                          â”‚
â”‚  3. Database Query Error                 â”‚
â”‚     â†’ 500 Response                       â”‚
â”‚     â†’ Log error server-side              â”‚
â”‚     â†’ User sees "Failed to fetch data"   â”‚
â”‚                                          â”‚
â”‚  4. Puppeteer Launch Failure             â”‚
â”‚     â†’ 500 Response                       â”‚
â”‚     â†’ Log error with stack trace         â”‚
â”‚     â†’ User sees "PDF generation failed"  â”‚
â”‚                                          â”‚
â”‚  5. Out of Memory                        â”‚
â”‚     â†’ 500 Response                       â”‚
â”‚     â†’ Alert DevOps                       â”‚
â”‚     â†’ User sees "Server error"           â”‚
â”‚                                          â”‚
â”‚  6. Timeout (> 30 seconds)               â”‚
â”‚     â†’ 504 Response                       â”‚
â”‚     â†’ User sees "Request timed out"      â”‚
â”‚                                          â”‚
â”‚  All errors:                             â”‚
â”‚    â€¢ Logged to console                   â”‚
â”‚    â€¢ Browser cleanup (finally block)     â”‚
â”‚    â€¢ User-friendly message               â”‚
â”‚    â€¢ No sensitive data exposed           â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Scalability Considerations

### Current Architecture (Phase 1)
- **Synchronous processing**: Request â†’ Generate â†’ Response
- **Resource usage**: ~300 MB RAM per export
- **Concurrency**: Limited by server memory
- **Estimated capacity**: ~10 concurrent exports

### Future Architecture (Phase 3+)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Client                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            API Route (Job Creator)                â”‚
â”‚                                                    â”‚
â”‚  â€¢ Create export job                              â”‚
â”‚  â€¢ Return job ID immediately                      â”‚
â”‚  â€¢ 202 Accepted response                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Job Queue (Bull/BullMQ)                â”‚
â”‚                                                    â”‚
â”‚  â€¢ Priority queue                                 â”‚
â”‚  â€¢ Retry logic                                    â”‚
â”‚  â€¢ Rate limiting                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Worker Process (Background)               â”‚
â”‚                                                    â”‚
â”‚  â€¢ Process jobs asynchronously                    â”‚
â”‚  â€¢ Generate PDFs                                  â”‚
â”‚  â€¢ Store in cloud storage (S3)                   â”‚
â”‚  â€¢ Send notification                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Notification                         â”‚
â”‚                                                    â”‚
â”‚  â€¢ Email with download link                       â”‚
â”‚  â€¢ In-app notification                            â”‚
â”‚  â€¢ WebSocket push                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Summary

This architecture leverages existing infrastructure (Puppeteer, Next.js, Supabase) to create a robust PDF export system. Key benefits:

1. **Reuses existing components** - minimal code duplication
2. **Server-side rendering** - consistent output across clients
3. **Professional quality** - 300 DPI, pixel-perfect fidelity
4. **Secure** - authentication, RLS, no file storage
5. **Extensible** - easy to add more sections
6. **Maintainable** - standard React patterns

The phased approach allows for incremental delivery while maintaining production stability.

















